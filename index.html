<html>
<head>
    <title>Real Time Visits</title>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
</head>
<body>
    <h1>
        Real-Time Visits</h1>
    <p>
        sample app demonstrating push notifications of visits to live website</p>
    
    <div>
      <b>Total visitors since <span id="count"></span></b>
    </div>
    
    <div id="messages"></div>
    
    <script type="text/javascript">
      var visitors = 0;
      var start;
      
      $(document).ready(function(){
        start = new Date();
      });      
      
      var source = new EventSource('http://localhost:1337');
      
      source.onopen = function (e) {
          console.log('new connection')
      };

      source.onmessage = function (e) {
          visitors++;
          $('#count').html(start + ' <h2>' + visitors + '</h2>');
          
          var visit = JSON.parse(e.data);

          $('#messages').append('<div>User Agent: ' + visit.HTTP_USER_AGENT + '</div>');
          $('#messages').append('<div>Query String: ' + visit.QUERY_STRING + '</div>');
          $('#messages').append('<div>Address: ' + visit.REMOTE_ADDR + '</div>');
          $('#messages').append('<div>Media Source: ' + visit.MediaSource + '</div>');
          $('#messages').append('<div>Campaign: ' + visit.Campaign + '</div>');
          $('#messages').append('<div>Keyword: ' + visit.Keyword + '</div>');
          $('#messages').append('<div>AdGroup: ' + visit.AdGroup + '</div>');
          $('#messages').append('<div>Referrer: ' + visit.Referrer + '</div>');
          $('#messages').append('<div>DateTime' + visit.CreateTime + '</div>');
          $('#messages').append('<br />');
      };

      source.onerror = function (e) {
          if (e.readyState == EventSource.CLOSED) {
              //do something.  perhaps.
          }
      };
    
    </script>
</body>
</html>
